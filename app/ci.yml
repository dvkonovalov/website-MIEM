app-flake8:
  stage: test
  image: python:3
  before_script:
    - cd app
    - pip install poetry
    - poetry install
  script:
    - poetry run flake8
  tags:
    - 1300-runner
  rules:
    - if: $CI_PIPELINE_SOURCE == 'merge_request_event' && $CI_MERGE_REQUEST_TARGET_BRANCH_NAME == 'main'
      changes:
        - app/**/*
    - if: $CI_COMMIT_BRANCH == 'main'

app-mypy:
  stage: test
  image: python:3
  before_script:
    - cd app
    - pip install poetry
    - poetry install
  script:
    - poetry run mypy .
  tags:
    - 1300-runner
  rules:
    - if: $CI_PIPELINE_SOURCE == 'merge_request_event' && $CI_MERGE_REQUEST_TARGET_BRANCH_NAME == 'main'
      changes:
        - app/**/*
    - if: $CI_COMMIT_BRANCH == 'main'
